

# Questions-answers 

Data Model questions

## Section 1: FileMaker Database Structure


1. What specific tables are modified when a new product is created in FileMaker? Please show me some screenshots of new products. Ideally a product only digital (although with a physical dummy) and a product with real physical and digital.
Answer Summary: Product, ContributorRole, TOCSongSources (if more than 1 song in a SKU)
Answers:
When a new product is created in FileMaker, the following tables are modified:
Product - This is the main table, and includes basic metadata info such as "Title", "WebDescription", etc.
ContributorRole - This table holds each contributor listing (last name, first name, role, sort order, etc.) per product.
TOCSongSources - This table isn’t always used.  This table lists out song titles within a publication.  One book might have multiple records in this table, with different song names.
DIGI Only Example - 00-52443 (“Dummy” sku) / 00-PK-0009345 (Digital “set” sku) - Jazz Pizzicato

2. What fields are required vs. optional when creating a dummy SKU? Can you show us a side-by-side comparison of a dummy record vs. a real physical product record — which fields are empty, which are filled with placeholder values?
Answer Summary: Most fields that are required for physical products are the same with dummy sku’s. There are a select few that require different values, listed below, and there are some fields that are specific to print that are not required unless we decide to print the dummy sku and make it into a regular physical item.
Answers:
Most of the data fields required for a dummy record are identical to what is needed for a physical record.  The dummy sku/record was developed almost as a physical “placeholder” since our systems were built with print first in mind.  The only fields in our Product table that would be slightly different, with example values, are:

| Table:Fieldname | Print value | Digital value |
|--|--|--|
|Product:OutputtoWeb |JJ114 | DIGIONLY|
|Product:DigitalOnlyYN | N | Y |



It is different depending on what product type it is: Choral, Ensemble/Performance Set, Book, or Sheet, as each requires slightly different data sets.  Then it is different depending on if an item is a physically printed product versus a digital only product.

Below are examples of titles, depending on the product type.  I have exported all of the fields and their values from the FileMaker Product database to show you the differences.  Not all these fields are required, in fact, there are probably only 100 or so that should be required.  We’re working on identifying which fields need to be required here:
this file is not accessible yet to me:
File: "FM Product Fields (working)" 

Here is the spreadsheet that shows the differences from the raw data export.  The headers are the fieldnames from Product:
this file is not accessible yet to me:
File: "Values for DigitalVSPhysical from PRODUCT"

a. Digital Only Versions (Dummy SKU needed in Product Table/TOCSongSource(if applicable)/ContributorRole)
    i. Choral - 00-50740
    ii. Ensemble/Performance Set - 00-52443
    iii. Book - 00-48779 (no contributors); 00-48639 (1 contributor)
    iv. Sheet - 00-52084
b. Physical & Digital Versions
    i. Choral - 00-20081
    ii. Ensemble/Performance Set - 00-38466
    iii. Book - 00-39101
    iv. Sheet - 00-35283

3. Is there a foreign key relationship between digital SKUs and physical SKUs in FileMaker, or is it just a naming convention? In other words, does the system enforce a link, or do humans just follow a pattern?
Answer Summary: Yes, the digital sku is created in SQL based on the physical/dummy sku in the “Ref_SKU” field
Answer:
The physical or dummy SKUs are the link between the digital skus that are created.  In SQL, this field is called “Ref_SKU”.  The digital skus are automatically generated by SQL, and added to our AS400 system.  It follows certain rules depending on the product type (for example chorals will always be formatted with “00-PO-#######” where “#” is a serialized number that is being picked up from the last time the process was run to create new choral digital skus)


4. What happens if you create a FileMaker record with Outputtoweb = DIGIONLY  but skip certain fields that would be required for a physical product? Does the system reject it, warn you, or accept it?
Answer Summary: it accepts it, and that field will be blank
Answer:
The system doesn’t have good validation and doesn’t have the logic to “check”.  If we skip certain fields, then the data that is downloaded nightly into the SQL tables tblapproducts or the “pending” table is blank, and then when we upload via portal.ax3.com, the SQL program which grabs the metadata from the nightly process, grabs blank data


5. Is there an existing record type or flag we could repurpose for "digital master" products, or would we need to add a new value (like Outputtoweb = DIGITALMASTER)?
Answer:
We could repurpose “DIGIONLY”, we just have to be sure SQL knows to watch for the new value.


## Section 2: AS400 Integration

6. When a dummy SKU is created in FileMaker, what exactly gets written to AS400? Is it a full inventory record or a minimal stub?
Answer Summary (confirm with Travis): a full inventory record is written to Filemaker.  Just to clarify, the FileMaker system doesn’t write to the AS400.  AS400 and FileMaker are not tied together in any way other than FileMaker reads data from the AS400.  The AS400 doesn’t reference the FileMaker table in any way.
Answer:
A full, new record is needed, but not all field requirements are the same for a digital record in the AS400 versus a physical record.  For example, the product status, while important only because the SQL program is watching the statues to push data, is less important for digital versus physical.  Same for things like a Print Order Number, which is something needed for a physical record, but not a digital one.  There are also certain things the SQL program is looking for on the physical/dummy AS400 record, that if are not setup correctly, will fail via portal.ax3.com.  Here are some examples:
    - Sets - ProductType=B
    - Job Numbers: There need to be a “###95” job number in the AS400 system for the original print/dummy sku job number, otherwise it won’t process.  For example, if the physical record’s job number is

7. Does AS400 track sales for digital-only products, or does that happen entirely in SQL Server? If a customer buys a digital product, which system records the transaction?
Answer Summary: yes, AS400 tracks sales for digital only products
Answer:
Yes, the AS400 tracks every transactional sale whether digital/physical/etc. for AX3.  We add “dummy” skus to the AS400 to mimic a physical version.  When items are run through portal.ax3.com, that system (backend is SQL) creates the digital skus in the AS400 to report sales for regardless if it is based on a physical version or not.

8. What would break if a digital product existed in SQL Server but had no corresponding record in AS400? Is AS400 queried during the purchase flow, or only for physical fulfillment?
Answer:
There would be nowhere to report the sale.  An AS400 record is required currently for any product that sells, digital or physical.  The sales transactions would be lost, and would have nowhere to go for reportin


9. Can you show us the AS400 record for a dummy SKU vs. a real physical SKU? What fields differ?
Answer Summary: they are the same
Answer:
This is mentioned above with the many screenshots of the AS400 records.  Each product type has their own nuances.
    i. All records
        1. Must have a price
        2. Must say Royalty=Y
        3. Physical AS400 record’s job number must have a “###95” equivalent in the job number table in the AS400
        4. Status: TOP
        5. New Issue Class: 252 (note this isn’t consistent currently, but it should be)
    ii. Sets - Must have Product Type = B
    iii. Chorals - Must have Product Type = C
    iv. Books - No unique fields
    v. Sheets - No unique fields


## Section 3: SQL Server and Digital SKU Generation

10. Can you walk us through the SQL Server code or stored procedure that generates digital SKUs? Does it require a physical SKU as input, or does it just need a parent record ID of some kind?
Answers:
a. This code was built by Doug Fraser initially, and then Chris Rubeiz managed it, and built the interface on portal.ax3.com for me to use.  I don’t have access to it, but Lee most likely does.
b. A while ago, they did build an option for not having a physical sku, but this still requires a royalty record and a songcode.  It’s not ideal the way it was built, and it’s why we prefer making a dummy sku because it makes it less complicated.  It does need a parent ID of some which we default to physical or dummy sku.

11. Where does the digital SKU naming pattern (e.g., 00-PK-0047888) come from? Is the 47888 part always derived from a physical SKU, or could it come from a different source?
Answer:
It’s serialized.  SQL picks up the next sequence when another batch of products are converted.  The only “logic” used is with the first two letter characters, which define what type of digital sku it is.  Here is a more detailed explanation of each digital sku type: Explaining Digital SKUs

12. If we created a new "digital master" record type, could SQL Server generate a digital SKU from that instead of from a physical/dummy SKU? What would need to change?
Answer Summary: yes, the digital SKU would just need to identify what type of prefix to use (00-PO, 00-PK, etc.)
Answer:
Because the digital sku creation is agnostic to the ref_sku, SQL will generate a digital sku regardless. It just depends on what workflow/product type path we go down.  For example, if we’re following the program that creates chorals, the skus will always start with “00-PO-”.  The rest of the numbers are serialized and not tied to the ref_sku.

13. What metadata fields does SQL Server require when creating a digital product? Which of those currently come from the physical SKU record vs. being entered fresh?
Answer:
Only books and sheets require their data to be entered fresh.  Choral/Performance music picks up data from the nightly data downloads into SQL from FileMaker.  I don’t have the specific fields, because I don’t have access to the SQL server, but it is things like Title/Series/WebDescription/etc that it picks up from the FileMaker Product database (actually the SQL download).

## Section 4: Royalty System

Skipped for now.


## Section 5: Portal and Workflow

18. When a template is uploaded to portal.ax3.com, what validation does it perform? Does it check that the physical/dummy SKU exists in FileMaker before proceeding?
Answer
I know that it is checking the data that is entered and certainly if there is blank data it returns errors.  It is also checking the AS400, Royalty, and FileMaker (through the nightly data downloads) data, but I don’t have a list of the checks it is doing.  Lee might know this better than I would because he has access to the program on the backend.  I know offhand that it is checking a few things depending on the workflow.

19. Could we modify the portal to accept a "digital master" SKU that doesn't have a corresponding physical record, or does the portal hard-code assumptions about physical SKUs existing?
Answer:
We currently have this functionality with the Dummy SKU, although there is a lot of setup on the backend that has to be done in order to get it to work.  The portal was built off of assumptions for physical though.

20. What's the technical relationship between the portal, SQL Server, FileMaker, and AS400? Does the portal talk to all of them directly, or does it only write to SQL Server which then syncs to the others?
Answer:
Portal.ax3.com writes to the SQL Server, and the AS400.  The AS400 writes to the Royalty system overnight.  FileMaker is downloaded every night and converted to a SQL table for access to the data through other systems.

21. Who maintains the portal code? Is it internal AX3 staff, a contractor, or a vendor? How difficult are changes to deploy?
Answer:
Doug Fraser originally built the system, but Chris Rubeiz built portal.ax3.com.  I guess now it is Lee (internal staff) who manages this.  Chris was reluctant to make changes for fear of causing other issues.  I’m not sure how comfortable Lee is with making changes to the system and I’m not sure of the difficulty.


## Section 6: Legato and Distribution

22. Does Legato require a physical SKU or any reference to one? When you send product data to Legato, what identifiers are included?
Answer:
No.  A digital SKU is required though.  Here is the full documentation from Legato on the metadata requirements for upload:
https://www.dropbox.com/scl/fi/g047cjnxxwp1n74hg4088/Legato-DMC-Metadata-Documentation.pdf?rlkey=venyaiiygqtp7bl2osuobztu8&dl=0

23. For digital-only products that don't go through Legato (Path C in Janea terminology), is that a business decision or a technical limitation? Could a digital-only product go through Legato if you wanted it to?
Answer: this is a business decision not to go through Legato.  Yes a digital-only product can go through Legato.

24. If we removed the dummy SKU requirement, would anything break in the Legato integration, or is Legato only aware of the digital SKU anyway?
Answer:
Nothing would break.  Legato only cares about the digital sku.  The dummy sku is something internal to AX3.


## Section 7: Downstream Reporting and Finance

25. Are there financial reports, royalty calculations, or analytics dashboards that assume every digital SKU has a parent physical SKU? Would digital-first products show up correctly in existing reports?
Answer: I don’t believe there is any need for every SKU to have a parent physical SKU


26. How does the royalty payment calculation work? Does it trace back to the physical SKU to determine who gets paid, or does it use the digital SKU directly?
Answer: the digital sku is programmed separately, it is not related to the physical sku

27. Are there any tax, accounting, or legal systems that reference the physical SKU for digital sales?
Answer: I don’t believe so


## Section 8: Historical Data and Migration

28. How many digital-only products (with dummy SKUs) exist today? If we changed the model, would we need to migrate those, or could old products stay as-is while new products use the new model?
Answer: About 500.  I believe these could stay as-is while new products use the new model.

29. Are there any products where the dummy SKU is referenced elsewhere — in contracts, printed catalogs, dealer agreements, or customer-facing materials?
Answer: No, dummy sku’s are only referenced internally

## Section 9: Exploring the “Possible"

30. Has anyone at AX3 ever attempted to create a digital product without a dummy SKU, even as a test? What happened?
Answer: 
We actually have some products with no dummy sku, and instead the refsku is something like “Piano”.  These publications didn’t have a physical relation.  These were done before portal.ax3.com was built, however.
We can currently upload without a dummy sku for books/sheets, but the website logic, I believe, will have some issues.  We’d have to test it.  We cannot upload without a refsku/dummy sku for Performance or Choral music because portal.ax3.com is pulling data based on the refsku/dummy sku from the FileMaker SQL nightly download, the AS400 system, and the Royalty system.

31. If we could wave a magic wand and remove the dummy SKU requirement tomorrow, what's your gut feeling on what would break first?
Answer:
Performance and Choral music wouldn’t work.
The website (ax3.com) may not be able to pull the appropriate data from the physical sku (we’d have to work with Jon on this).
The dummy sku, while a pain, does help us track, internally, a project, and gives us the option to make something available in print.

32. Is there institutional knowledge about why the dummy SKU was introduced in the first place? Was it a technical requirement or a business process decision that got encoded into the system?
Answer: there may have been other reasons, but as I understand it, a dummy sku was created so that royalties could be programmed as a physical product. Then, for many years, we went through a process (since abandoned), where the royalties for the digital sku were programmed automatically based on the physical sku (digital royalty rates are different than physical, but logic was created in the program to accommodate that)

The performance and choral processes are dependent upon having a physical sku or a dummy sku because portal.ax3.com is pulling the metadata for either the dummy sku or the physical sku.  Rather than building a new system, the developers decided a dummy sku was more economical I guess.


## Path A: Physical-to-Digital

33. How long does the Legato MRID round-trip take, and does Legato have an API?
Answer
When you refer to “roundup” do you mean how long does it take me to download the new MRIDs and input them into our systems?  It takes maybe 5 or 10 mins.  Legato (app.legatomedia.com) does not have an API to tie into our systems as of today.


34. What percentage of template fields could be auto-populated from existing FileMaker data?
Answer
Most are already.  I set up a script in FileMaker to output data formatted in our book/sheet templates.  The bigger problem is that our FileMaker data is more robust than what is offered through Legato, and it can be like trying to fit a square peg into a round hole.


35. What causes the column AK import failure, and why hasn't it been fixed?
Answer:
The data reports aren’t being maintained anymore and every time a certificate renew happens, things can change.  That’s my guess as to why it hasn’t been fixed.  This AK issue is minor compared to the Dealer Data file not being formatted in tab delimited anymore or that these reports aren’t automatically uploaded.


## Path B: Digital-Only

36. What is the minimum required data to create a dummy SKU, and could it be generated automatically with a single click?
Answer
    - Single Click?  Possibly.  We have to create records in FileMaker and the AS400 (which then goes to royalties). 
    - Min. required data
        a. AS400 (note that the AS400 requires some fields that aren’t needed for dummy skus.  Let me know if you’d like me to include those here)
            1. Pub Number
            2. Item Number: Note PUB-ITEM = Dummy SKU
            3. Title
            4. Territory Restrictions
            5. Job Number
            6. Royalty = Y
            7. Price
            8. Product Type Code
            9. Company Number
            10. Pub Date (MM/YY)
        b. FileMaker
            1. Webclean Title
            2. Title for Sorting
            3. Comp arr trans artist
                - Contributors must be created in ContributorRole database
            4. Webdescription
            5. Shortdescription
            6. Product Line
            7. FM Category
            8. WebDefinition
            9. WebFormat
            10. Humanreadable Publisher Name
            11. Brand
            12. Pubnum
            13. Xitemnum
            14. Webinstrumentgroup
            15. Webensemble
            16. Keywords
            17. Webinstrument
            18. Webchoirvoicing
            19. Webvoice
            20. WebProductType
            21. WebProductSubType
            22. WebSpecialFeatures
            23. WebGenre
            24. WebSource
            25. WebHoliday
            26. WebOccassion
            27. WebSeason
            28. WebGrade
            29. WebLevel
            30. WebSubLevel
            31. WebPopLevel
            32. WebMusicalForm
            33. WebEra
            34. NAMM Code - this is only needed in order to load Web Definitions on ax3.com properly.



37.    	Is Legato integration required for digital-only products, or can they skip it entirely?
Today, the Legato process IS required for digital-only products and can’t easily be skipped. There are a few cases where the team has worked around that in the past, but it’s a convoluted and manual process. When AX3 first looked at selling products digitally, using Legato was the fastest path to get those products into the market. Years later, that process has been added to over time but the “digital product” path (independent of digital-only or physical-and-digital) is still based on that Legato-based process (for the data, the upload/download flow of product assets). See below “Bypassing Legato” section we added.

38.    	Where does metadata originate for digital-only products, and is there a standard intake process?
Answer:
Metadata for digital only products is developed by Editorial in the same manner that physical metadata is developed by Editorial.  Yes, we have a standard intake process for that data whether physical or digital.



## Path C: Electronic Resources

39. What is the actual end-to-end workflow for ER products—is it documented, or tribal knowledge?
Do you want to know about eBooks, or about submitting a PDF for sale on ax3.com using the “ER” item?  The latter was done only a handful of times as it was a “duct tape” solution for when we wanted to post PDFs on ax3.com and circumvent the Legato system.  For eBooks, we don’t produce them anymore and haven’t since about 2018.
For the ER PDFs we submit to ax3.com, the process is still new, and needs to be documented.  A 30,000 foot view is:
    1. AS400 record for “ER” version created
    2. FileMaker record for “ER” version created
        - Data is added via normal workflows to FileMaker and Travis is alerted
    3. Data is reviewed and the field “Outputtoweb” is set to “JJ114”, which is the trigger to go live on ax3.com once the nightly data is downloaded the following day.
    4. Extra “asset” data is added to the ProductAssets table in the Product database including asset name
    5. PDF or Zip file is uploaded to an AWS bucket /alfred-sellable-digital-products-other

40. How do you test interactive PDFs and ZIP packages before they go live, and how often do customers report problems?
Answer:
Visual/manual inspection.  I don’t have metrics on customer complaints, but because we have so few products setup this way, we haven’t received a lot of complaints other than the fact that the PDFs aren’t watermarked with the customer name which can be an issue for contests.

41. What's the volume of ER products, and is there business demand to distribute them through dealers?
Right now, we only have 5.  Not sure about whether or not we are wanting to make these available for dealers or not.
 



# Bypassing Legato - Info
From a recent discussion on what would be required to list digital products on our ax3.com site WITHOUT those products being sent out to Legato. 

The team identified the following needs:

1. The ability to tag AX3-only or Legato-or-not in the SQL database + the logic ability to read that downstream in the AX3.com product database
2. Digital Production team would need the ability to manipulate (self serve) the following fields (in the digital products SQL Server table, possibly called MR Upload). Today, the team has to go to an AX3 data engineer to make these changes.
    - DateAdded
    - TerritoryCode
    - Territory
    - ens_Sort
    - ens_SetQty
    - SKU
    - *Please note that these are essential fields, there is a long list of lower priority fields that may be needed in the future
3. The ability to globally change data on all digital skus related to a single reference sku
Ex) Digital SKUs: 00-PC-0019547_F1 (Four Seasonal Rounds: Flute) & 00-PC-0019547_O1 (Four Seasonal Rounds: Oboe)
Ex) Reference SKU: 00-51402	(Four Seasonal Rounds)
Today, the team uses this report to view that SKU data in MR Upload - http://alfredawssql06.alfredpub.com/reports/report/Digital_Reports/Full_MR_Upload_Table
Re: making the SKU data change “globally”: 
To illustrate the need, here is an example.  When we have a performance set that we sell, we have to have one record in the SQL table for EACH part and the set SKU.  So an average performance set has about 20 parts, or let's say it has 22 records in the SQL table (1 for the set; 1 for the score; 20 for the parts).  James Grupenhoff reaches out to me, telling me that we now are not allowed to sell this performance set in Europe, so  I have to change the territory/territory code to reflect this.  In order to do this properly, because every part can be sold alone (22 records), each record has to have their territory/territory code modified to not allow them to be sold in Europe.  In order to do this, all 22 records need to be modified.  We don't currently have a way to "en mass" or "globally" change all 22 records at this time, and anything that I mention below that we currently can change within the UI (portal.ax3.com) we have to change 1 part at a time.
There is a legacy UI available via portal.ax3.com under "TSM > Digital Product Search", located here: https://portal.ax3.com/TSM/Digital/DigitalProductSearch.aspx
This interface allows us to search for a digital OR physical SKU, find the associated records, and then manipulate the below listed data fields the MR Upload SQL table.  (While still useful, when encountering a performance set, like the example above with 22 records, the Digital Production team has to manually go in and change all 22 records individually on this UI which is very tedious.  
    - Preview Pages
    - Total Pages
    - Price
    - Enable/Disable
    - Title
    - TitleWRK
    - Title Simple
    - Arrangement
    - Landscape
    - Description
    - Disable Reason

## GLOSSARY for SKU Types
### Types of DIGITAL SKUs:
1. Sold through Legato/MR Upload - https://docs.google.com/document/d/1XuTianeH97I3gqfv7pOIdJwr0L_kGwDXt31SFNVTr6k/edit?tab=t.0#heading=h.k5xnolpf5zuk
2. "ER" SKUs.  These are SKUs with item numbers that begin "ER".  These were originally for eBook versions of our physical publications, but during the pandemic, we made google slides that needed transactions to report to, and they also used a few hundred "ER" skus.  Example: 00-ER42005 (Physical/Reference/Parent SKU = 00-42005)
3. "AA-" or "A-" SKUs.  These are for digital audio that we sell through some dealers and ax3.com.  "A" stands for 1 song, whereas "AA" represents a full album.  Most, but not all, "A" or "AA" sku has a physical disc version that we sell or have sold in the past.  Examples: 00-A-00016047 is a one track song which is a recording of a choral piece which we sell in print form.  We also sell a Soundtrax CD for this audio, and that is the Reference/Parent/Physical SKU related to this "A-" sku, which is 00-51234; 00-AA-0000235 is similar in setup to the "A-" sku example before, but it has more tracks, and is more considered an "Album", hence the "AA-".  NOTE: These are also sold thru Naxos, which distributes them thru Apple Music, Amazon Music, etc., and is managed by Eric Fortin.

### Physical SKUs / Reference SKUs / Parent SKUs
These are publications that are manufactured and delivered as a physical good to the warehouse/customer whether it be a book, performance set, choral octavo, CD, DVD, Sheet Music, or any variety of the above.

### Web SKU
Unsure. 
